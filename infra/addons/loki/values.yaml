loki:
  deploymentMode: SingleBinary

  loki:
    # Disable authentication (enable in production)
    auth_enabled: false

    # Common settings shared across all Loki components
    commonConfig:
      # Base path for Loki data storage
      path_prefix: /tmp/loki
      # Replication factor: 1=no replication (dev), 3=HA (prod)
      replication_factor: 1
      # Storage configuration - this overrides chart defaults
      storage:
        filesystem:
          chunks_directory: /tmp/loki/chunks  # Compressed log data
          rules_directory: /tmp/loki/rules    # Alerting/recording rules

    # Storage backend: filesystem (dev) | s3/gcs/azure (prod)
    storage:
      type: filesystem
      filesystem:
        chunks_directory: /tmp/loki/chunks
        rules_directory: /tmp/loki/rules

    # Schema defines how data is stored and indexed
    schemaConfig:
      configs:
        - from: "2024-01-01"        # Schema effective date
          store: tsdb               # Time Series DB (better performance)
          object_store: filesystem  # Must match storage.type
          schema: v13              # Latest stable schema version
          index:
            prefix: loki_index_    # Index file prefix
            period: 24h           # Daily index rotation
    compactor:
      retention_enabled: true
      retention_delete_delay: 2m
      working_directory: /tmp/loki/compactor  # Compaction storage
    # Ruler processes alerting and recording rules
    ruler:
      storage:
        type: local
        local:
          directory: /tmp/loki/rules  # Rules storage directory
      wal:
        dir: /tmp/loki/ruler-wal     # Write-Ahead Log for durability
    
    # Storage config overrides to ensure all paths use /tmp/loki
    storage_config:
      bloom_shipper:
        working_directory: /tmp/loki/data/bloomshipper
      tsdb_shipper:
        active_index_directory: /tmp/loki/tsdb-index
        cache_location: /tmp/loki/tsdb-cache

  # SingleBinary deployment configuration
  singleBinary:
    replicas: 1                    # Single instance (dev)
    persistence:
      enabled: false               # No persistent storage (ephemeral)
    # Temporary storage volumes
    extraVolumes:
      - name: loki-data
        emptyDir: {}               # Ephemeral storage
    extraVolumeMounts:
      - name: loki-data
        mountPath: /tmp/loki       # Mount at data path

  # Disable caching for development (enable for production performance)
  chunksCache:
    enabled: false
  resultsCache:
    enabled: false

  # Disable gateway (not needed in SingleBinary mode)
  gateway:
    enabled: false

  # Disable built-in tests
  test:
    enabled: false

  # Microservices components (disabled in SingleBinary mode)
  backend:
    replicas: 0  # Handles storage/compaction in microservices mode
  read:
    replicas: 0  # Handles queries in microservices mode
  write:
    replicas: 0  # Handles ingestion in microservices mode