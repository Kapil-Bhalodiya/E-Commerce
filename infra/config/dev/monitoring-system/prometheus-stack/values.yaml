namespace: dev

# Configuration for kube-prometheus-stack subchart
kube-prometheus-stack:
  # Grafana configuration for DEV environment
  grafana:
    adminPassword: "devadmin123"
    
    grafana.ini:
      server:
        domain: "dev.grafana.local"
        root_url: "http://dev.grafana.local:8000/"
        serve_from_sub_path: false
      auth.anonymous:
        enabled: false
    
    # Fixed ingress structure
    ingress:
      enabled: true
      ingressClassName: nginx
      annotations:
        nginx.ingress.kubernetes.io/ssl-redirect: "false"
        nginx.ingress.kubernetes.io/force-ssl-redirect: "false"
        nginx.ingress.kubernetes.io/backend-protocol: "HTTP"
      hosts:
        - "dev.grafana.local"
      path: /
    
    additionalDataSources:
      - name: Prometheus
        type: prometheus
        url: http://prometheus-stack-dev-kube-prom-prometheus:9090
        access: proxy
        isDefault: true

  # Prometheus dev settings
  prometheus:
    prometheusSpec:
      serviceMonitorSelector:
        matchLabels:
          release: prometheus-stack-dev
      resources:
        requests:
          cpu: "100m"
          memory: "512Mi"
        limits:
          cpu: "500m"
          memory: "1Gi"
      storageSpec:
        volumeClaimTemplate:
          spec:
            resources:
              requests:
                storage: 5Gi

  # Keep node-exporter enabled in dev (disable in prod)
  prometheus-node-exporter:
    enabled: true

# Service monitors for dev
app:
  serviceMonitors:
    - name: backend-dev-monitor
      namespace: dev
      selector:
        matchLabels:
          app.kubernetes.io/instance: backend-dev
          app.kubernetes.io/name: backend
      endpoints:
        - port: http
          path: /metrics
          interval: 15s
    - name: frontend-dev-monitor  
      namespace: dev
      selector:
        matchLabels:
          app.kubernetes.io/instance: frontend-dev
          app.kubernetes.io/name: frontend
      endpoints:
        - port: http
          path: /metrics
          interval: 15s