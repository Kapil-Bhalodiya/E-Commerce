namespace: dev

# Grafana configuration for DEV environment
grafana:
  adminPassword: "devadmin123"
  
  grafana.ini:
    server:
      domain: "dev.grafana.local"
      root_url: "http://dev.grafana.local:8000/"
      serve_from_sub_path: false
    auth.anonymous:
      enabled: false
  
  ingress:
    enabled: true  # Enable ingress for external access
    ingressClassName: nginx  # Use nginx ingress controller
    annotations:
      nginx.ingress.kubernetes.io/ssl-redirect: "false"  # No HTTPS redirect in dev
      nginx.ingress.kubernetes.io/force-ssl-redirect: "false"
    hosts:
      - host: dev.grafana.local
        paths:
          - path: /
            pathType: Prefix
    tls: []
  
  # Fixed Prometheus service URL
  additionalDataSources:
    - name: Prometheus
      type: prometheus
      url: http://prometheus-stack-dev-prometheus:9090
      access: proxy
      isDefault: true

# Prometheus dev settings
prometheus:
  prometheusSpec:
    # Service monitor selector - which services to monitor
    serviceMonitorSelector:
      matchLabels:
        release: prometheus-stack-dev
    resources:
      requests:
        cpu: "100m"
        memory: "512Mi"
      limits:
        cpu: "500m"
        memory: "1Gi"
    storageSpec:
      volumeClaimTemplate:
        spec:
          resources:
            requests:
              storage: 5Gi

# Fix node-exporter for dev
prometheus-node-exporter:
  hostNetwork: false  # Don't use host network
  service:
    port: 9100
    targetPort: 9100

# Service monitors for dev
app:
  serviceMonitors:
    - name: backend-dev-monitor
      namespace: dev
      selector:
        matchLabels:
          app.kubernetes.io/instance: backend-dev
          app.kubernetes.io/name: backend
      endpoints:
        - port: http
          path: /metrics
          interval: 15s
    - name: frontend-dev-monitor  
      namespace: dev
      selector:
        matchLabels:
          app.kubernetes.io/instance: frontend-dev
          app.kubernetes.io/name: frontend
      endpoints:
        - port: http
          path: /metrics
          interval: 15s