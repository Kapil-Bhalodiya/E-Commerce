# Development Loki Configuration
# This file contains development-specific Loki settings for log aggregation
# Configured for SimpleScalable deployment mode with reduced resources

# Loki log aggregation system configuration
loki:
  # Use SimpleScalable deployment mode for development
  # This separates components but with minimal resources for testing
  deploymentMode: SimpleScalable
  
  # Loki core configuration
  loki:
    fullnameOverride: loki-dev   # Override name for development instance
    
    # Authentication and security
    auth_enabled: false          # Disable authentication for development
    
    # Storage configuration using filesystem (not cloud storage)
    storage:
      type: filesystem           # Use local filesystem storage
      bucketNames:
        chunks: loki-chunks-dev  # Chunk storage bucket name
        ruler: loki-ruler-dev    # Ruler storage bucket name
        admin: loki-admin-dev    # Admin storage bucket name
    
    # Development-friendly limits (more permissive)
    limits_config:
      retention_period: 7d       # Keep logs for 7 days (shorter for dev)
      ingestion_rate_mb: 8       # Lower ingestion rate for dev
      ingestion_burst_size_mb: 16 # Smaller burst size for dev
    
    # Storage backend configuration
    storage_config:
      filesystem:
        directory: /var/loki/data # Directory for storing log data
      boltdb_shipper:
        active_index_directory: /var/loki/data/boltdb-index
        cache_location: /var/loki/data/boltdb-cache
        shared_store: filesystem
  
  # Backend component configuration (handles compaction, deletion, etc.)
  backend:
    replicas: 1                  # Single replica for development
    resources:
      requests:
        cpu: "20m"               # Minimal CPU for development
        memory: "200Mi"          # Minimal memory for development
      limits:
        cpu: "100m"              # Lower CPU limit for dev
        memory: "300Mi"          # Lower memory limit for dev
    persistence:
      enabled: false             # Disable persistence for development (ephemeral)
  
  # Read component configuration (handles queries)
  read:
    replicas: 1                  # Single replica for development
    resources:
      requests:
        cpu: "16m"               # Minimal CPU for development
        memory: "195Mi"          # Minimal memory for development
      limits:
        cpu: "50m"               # Lower CPU limit for dev
        memory: "1Gi"            # Memory limit for read operations
    persistence:
      enabled: false             # Disable persistence for development
  
  # Write component configuration (handles log ingestion)
  write:
    replicas: 1                  # Single replica for development
    resources:
      requests:
        cpu: "41m"               # Minimal CPU for development
        memory: "804Mi"          # Memory for write operations
      limits:
        cpu: "100m"              # Lower CPU limit for dev
        memory: "1Gi"            # Memory limit for write operations
    persistence:
      enabled: false             # Disable persistence for development
  
  # Gateway component configuration (load balancer/proxy)
  gateway:
    replicas: 1                  # Single replica for development
    resources:
      requests:
        cpu: "10m"               # Minimal CPU for development
        memory: "100Mi"          # Minimal memory for development
      limits:
        cpu: "25m"               # Lower CPU limit for dev
        memory: "250Mi"          # Lower memory limit for dev
  
  # Disable components not needed for development
  singleBinary:
    replicas: 0                  # Disable single binary mode
  
  # Monitoring configuration
  monitoring:
    serviceMonitor:
      enabled: true              # Enable Prometheus monitoring
      labels:
        release: prometheus-stack-dev  # Label for Prometheus discovery
  
  # Disable optional components to reduce resource usage
  minio:
    enabled: false               # No MinIO object storage
  lokiCanary:
    enabled: false               # No canary testing in development
  ruler:
    enabled: false               # No alerting rules in development
  test:
    enabled: false               # No test pods in development