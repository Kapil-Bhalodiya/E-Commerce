# Production Loki Configuration
# This file contains production-specific Loki settings for log aggregation
# Configured for SimpleScalable deployment mode with filesystem storage

# Loki log aggregation system configuration
loki:
  # Use SimpleScalable deployment mode for production
  # This separates read, write, and backend components for better scalability
  deploymentMode: SimpleScalable
  
  # Loki core configuration
  loki:
    fullnameOverride: loki-prod  # Override name for production instance
    
    # Authentication and security
    auth_enabled: false          # Disable authentication for internal use
    
    # Storage configuration using filesystem (not cloud storage)
    storage:
      type: filesystem           # Use local filesystem storage
      bucketNames:
        chunks: loki-chunks-prod # Chunk storage bucket name
        ruler: loki-ruler-prod   # Ruler storage bucket name
        admin: loki-admin-prod   # Admin storage bucket name
    
    # Rate limiting and retention configuration
    limits_config:
      retention_period: 30d      # Keep logs for 30 days
      ingestion_rate_mb: 16      # Maximum ingestion rate per tenant
      ingestion_burst_size_mb: 32 # Burst size for ingestion spikes
    
    # Storage backend configuration
    storage_config:
      filesystem:
        directory: /var/loki/data # Directory for storing log data
      boltdb_shipper:
        active_index_directory: /var/loki/data/boltdb-index
        cache_location: /var/loki/data/boltdb-cache
        shared_store: filesystem
  
  # Backend component configuration (handles compaction, deletion, etc.)
  backend:
    replicas: 1                  # Single replica for production
    resources:
      requests:
        cpu: "40m"               # Minimum CPU required
        memory: "200Mi"          # Minimum memory required
      limits:
        cpu: "200m"              # Maximum CPU allowed
        memory: "300Mi"          # Maximum memory allowed
    persistence:
      enabled: true              # Enable persistent storage
      size: "20Gi"              # Storage size for backend data
  
  # Read component configuration (handles queries)
  read:
    replicas: 1                  # Single replica for production
    resources:
      requests:
        cpu: "16m"               # Minimum CPU required
        memory: "496Mi"          # Minimum memory required
      limits:
        cpu: "100m"              # Maximum CPU allowed
        memory: "1Gi"            # Maximum memory allowed
    persistence:
      enabled: true              # Enable persistent storage
      size: "10Gi"              # Storage size for read cache
  
  # Write component configuration (handles log ingestion)
  write:
    replicas: 1                  # Single replica for production
    resources:
      requests:
        cpu: "29m"               # Minimum CPU required
        memory: "1Gi"            # Minimum memory required
      limits:
        cpu: "200m"              # Maximum CPU allowed
        memory: "2Gi"            # Maximum memory allowed
    persistence:
      enabled: true              # Enable persistent storage
      size: "30Gi"              # Storage size for write buffer
  
  # Gateway component configuration (load balancer/proxy)
  gateway:
    replicas: 1                  # Single replica for production
    resources:
      requests:
        cpu: "10m"               # Minimum CPU required
        memory: "100Mi"          # Minimum memory required
      limits:
        cpu: "50m"               # Maximum CPU allowed
        memory: "300Mi"          # Maximum memory allowed
  
  # Disable components not needed for this deployment
  singleBinary:
    replicas: 0                  # Disable single binary mode
  
  # Monitoring configuration
  monitoring:
    serviceMonitor:
      enabled: true              # Enable Prometheus monitoring
      labels:
        release: prometheus-stack-prod  # Label for Prometheus discovery
  
  # Disable optional components to reduce resource usage
  minio:
    enabled: false               # No MinIO object storage
  lokiCanary:
    enabled: false               # No canary testing
  ruler:
    enabled: false               # No alerting rules
  test:
    enabled: false               # No test pods